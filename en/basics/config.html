<!DOCTYPE html>
<html lang="en">
<head>
  <title>Configuration - Born to build better enterprise frameworks and apps</title>
  <meta charset="utf-8">
  <meta name="description" content="index.description">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="icon" href="/images/favicon.png" type="image/x-icon">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" href="/css/index.css">

</head>
<body>
  <div class="nav" >
  <header>
    <a href="/" class="nav-logo leftpadding" alt="egg"><img src="https://zos.alipayobjects.com/rmsportal/VTcUYAaoKqXyHJbLAPyF.svg"></a>
    <ul class="nav-item">
      <li>
        <form id="search-form">
          <input type="text" id="search-query" class="search-query st-default-search-input">
        </form>
      </li>
      <li><a href="intro/" alt="Guide">Guide</a></li><li><a href="/api/" alt="API">API</a></li><li><a href="tutorials/index.html" alt="Tutorials">Tutorials</a></li><li><a href="https://github.com/search?q=topic%3Aegg-plugin&type=Repositories" alt="Plugins">Plugins</a></li><li><a href="https://github.com/eggjs/egg/releases" alt="Release">Release</a></li>
      <!--
      <li class="translations">
        <a class="nav-link">Translations</a>
        <span class="arrow"></span>
        <ul class="dropdown-content">
          <li><a href="/">中文</a></li>
          <li><a href="/">English</a></li>
        </ul>
      </li>
      -->
      <li><iframe src="https://ghbtns.com/github-btn.html?user=eggjs&repo=egg&type=star&count=true" frameborder="0" scrolling="0" width="150px" height="20px"></iframe></li>
    </ul>
    <a id="mobileTrigger" href="#" class="mobile-trigger">
      <ul>
        <li></li>
        <li></li>
        <li></li>
      </ul>
    </a>
  </header>
</div>

  <div id="container" class="container">
    <div class="page-main">
  <article class="markdown-body">
    <h1>Configuration</h1>
    <p>This framework provides powerful and extensible configuration function, including automatically merging applications, plugins, and framework's configuration. In addition, it allows users to overwrite configuration in sequence and maintain different configs depending on different environments. The result (i.e. merged config) can be accessed from <code>app.config</code>.</p>
<p>Here are some common control tactics:</p>
<ol>
<li>Using platform to manage configurations: while building a new application, you can put the current environment configuration into package and trigger the configuration as long as you run this application. But this certain application won't be able to build several deployments at once, and you will get into trouble whenever you want to use the configuration in localhost.</li>
<li>Using platform to manage configurations: you can pass the current environment configuration via environment variables while starting. This is a relatively elegant approach with higher requirement on operation and support from configuration platform. Moreover, The configuration environment has same flaws as first method.</li>
<li>Using code to manage configurations: you can add some environment configurations in codes and pass them  to current environment arguments while starting. However, it doesn't allow you to configurate globally and you need to alter your code whenever you want to change the configuration.</li>
</ol>
<p>we choose the last strategy, namely <strong>configurate with code</strong>, The change of configuration should be also released after review. The application package itself is capable to be deployed in several environments, only by specifing the running environment.</p>
<h3 id="multiple-environment-configuration"><a class="markdown-anchor" href="#multiple-environment-configuration">#</a> Multiple environment configuration</h3>
<p>This framework suppports loading configuration according to the environment and defining configuration files of multiple enviroments. For more details, please check <a href="../basics/env.html">env</a>.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">config</div><div class="line">|- config.default.js</div><div class="line">|- config.test.js</div><div class="line">|- config.prod.js</div><div class="line">|- config.unittest.js</div><div class="line">|- config.local.js</div></pre></td></tr></table></figure>
<p><code>config.default.js</code> is the default file for configuration, and all environments will load this file. Besides, this is usually used as default configuration file for development environment.</p>
<p>The corresponding configuration file will be loaded simultaneously when you set up env and the default configuration with the same name will be overwritten. For example, <code>prod</code> environment will load <code>config.prod.js</code> and <code>config.default.js</code>. As a result, <code>config.prod.js</code> will overwrite the configuration with identical name in <code>config.default.js</code>.</p>
<h3 id="how-to-write-configuration"><a class="markdown-anchor" href="#how-to-write-configuration">#</a> How to write configuration</h3>
<p>The configuration file returns an object which could overwrite some configurations in the framework. Application can put its own business configuration into it for convenient management.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// configurate the catalog of logger，the default configuration of logger is provided by framework</span></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  logger: &#123;</div><div class="line">    dir: <span class="string">'/home/admin/logs/demoapp'</span>,</div><div class="line">  &#125;,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>The configuration file can simplify to <code>exports.key = value</code> format</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">exports.keys = <span class="string">'my-cookie-secret-key'</span>;</div><div class="line">exports.logger = &#123;</div><div class="line">  level: <span class="string">'DEBUG'</span>,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>The configuration file can also return a function which could receive a parameter called <code>appInfo</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// put the catelog of logger to the catalog of codes</span></div><div class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">appInfo</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    logger: &#123;</div><div class="line">      dir: path.join(appInfo.baseDir, <span class="string">'logs'</span>),</div><div class="line">    &#125;,</div><div class="line">  &#125;;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>The build-in appInfo contains:</p>
<table>
<thead>
<tr>
<th>appInfo</th>
<th>elaboration</th>
</tr>
</thead>
<tbody>
<tr>
<td>pkg</td>
<td>package.json</td>
</tr>
<tr>
<td>name</td>
<td>Application name, same as pkg.name</td>
</tr>
<tr>
<td>baseDir</td>
<td>The directory of codes</td>
</tr>
<tr>
<td>HOME</td>
<td>User directory, e.g, the account of admin is /home/admin</td>
</tr>
<tr>
<td>root</td>
<td>The application root directory, if the environment is local or unittest, it is baseDir. Otherwise, it is HOME</td>
</tr>
</tbody>
</table>
<p><code>appInfo.root</code> is an elegant adaption. for example, we tend to use <code>/home/admin/logs</code> as the catalog of log in the server environment, while we don't want to pollute the user catalog in local development. This adaptation is very good at solving this problem.</p>
<h3 id="sequence-of-loading-configurations"><a class="markdown-anchor" href="#sequence-of-loading-configurations">#</a> Sequence of loading configurations</h3>
<p>Applications, plugin components and framework are able to define those config. Even though the structure of catalog is identical but there is priority (application &gt; framework &gt; plugin). Besides, the running environment has the highest priority.</p>
<p>Here is one sequence of loading configurations under &quot;prod&quot; environment, in which the following configuration will overwrite the previous configuration with the same name.</p>
<pre><code>-&gt; plugin config.default.js
-&gt; framework config.default.js
-&gt; application config.default.js
-&gt; plugin config.prod.js
-&gt; framework config.prod.js
-&gt; application config.prod.js
</code></pre>
<p><strong>Note: there will be plugin loading sequence, but the approximate order is similar. For specific logic, please check the <a href="../advanced/loader.html">loader</a> .</strong></p>
<h3 id="merging-rule"><a class="markdown-anchor" href="#merging-rule">#</a> Merging rule</h3>
<p>Configs are merged using deep copy from [extend2] module, which is forked from [extend] and process array in a different way.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> a = &#123;</div><div class="line">  arr: [ <span class="number">1</span>, <span class="number">2</span> ],</div><div class="line">&#125;;</div><div class="line"><span class="keyword">const</span> b = &#123;</div><div class="line">  arr: [ <span class="number">3</span> ],</div><div class="line">&#125;;</div><div class="line">extend(<span class="literal">true</span>, a, b);</div><div class="line"><span class="comment">// =&gt; &#123; arr: [ 3 ] &#125;</span></div></pre></td></tr></table></figure>
<p>As demonstrated above, the framework overwirte arrays instead of merging them.</p>
<h2 id="plugin-configuration"><a class="markdown-anchor" href="#plugin-configuration">#</a> plugin Configuration</h2>
<p>In the application, we can control some options of plugins via <code>config/plugin.js</code>.</p>
<h3 id="enabledisable"><a class="markdown-anchor" href="#enabledisable">#</a> Enable/Disable</h3>
<p>The framework has some bulid-in plugins which can be enabled or disabed via the configuration. Once the plugin is disabled, all files of this plugin won't be loaderd any more.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// disable the built-in i18n plugin</span></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  i18n: &#123;</div><div class="line">    enable: <span class="literal">false</span>,</div><div class="line">  &#125;,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>Or we can simply set a boolean value</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  i18n: <span class="literal">false</span>,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="how-to-load-plugins"><a class="markdown-anchor" href="#how-to-load-plugins">#</a> How to load plugins</h3>
<p>The framework builds in <a href="https://github.com/eggjs/egg/blob/master/config/plugin.js" target="_blank" rel="external">some plugins</a> that is commonly used for enterprise applications.</p>
<p>And application developers can load other plugins to Meet business needs just by specifying the <code>package</code> configuration</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// use mysql plugin</span></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  mysql: &#123;</div><div class="line">    enable: <span class="literal">true</span>,</div><div class="line">    package: <span class="string">'egg-mysql'</span>,</div><div class="line">  &#125;,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>As a npm module, <code>package</code> must add dependency to <code>pkg.dependencies</code>. The framework will search this module in node_modules directory and find it as the plugin entry.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;dependencies&quot;: &#123;</div><div class="line">    &quot;egg-mysql&quot;: &quot;^1.0.0&quot;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>Note: use dependencies rather than devDependencies to config plugins even used in the development phase in case <code>npm -i --production</code> fails.</strong></p>
<p>Alternatively, we can use path to replace package.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  mysql: &#123;</div><div class="line">    enable: <span class="literal">true</span>,</div><div class="line">    path: path.join(__dirname, <span class="string">'../app/plugin/egg-mysql'</span>),</div><div class="line">  &#125;,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>path is an absolute path so that the application can put self developed plugins in the application directory, such as <code>app/plugin</code>.</p>
<h2 id="configuration-result"><a class="markdown-anchor" href="#configuration-result">#</a> Configuration result</h2>
<p>The final merged config will be dumped to <code>run/application_config.json</code>(for worker process) and <code>run/agent_config.json</code>(for agent process) when the framework started, which can help analyzing problems.</p>
<p>Some fields are hidden in the config file, mainly including 2 types:</p>
<ul>
<li>like passwords, secret keys and other security related fields which can be configured in <code>config.dump.ignore</code> and only <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set" target="_blank" rel="external">Set</a> type is accepted. See <a href="https://github.com/eggjs/egg/blob/master/config/config.default.js" target="_blank" rel="external">Default Configs</a></li>
<li>like Function, Buffer, etc. whose content converted by <code>JSON.stringify</code> will be specially large.</li>
</ul>
<p><code>run/application_config_meta.json</code> (for worker process）and <code>run/agent_config_meta.json</code> (for agent process) will also be dumped that show which file defines the property, see below</p>
<figure class="highlight json"><table><tr><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"logger"</span>: &#123;</div><div class="line">    <span class="attr">"dir"</span>: <span class="string">"/path/to/config/config.default.js"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

  </article>
  <aside id="mobileAside" class="toc">
  <div class="mobile-menu">
    <ul><li><a href="intro/" alt="Guide">Guide</a></li><li><a href="/api/" alt="API">API</a></li><li><a href="tutorials/index.html" alt="Tutorials">Tutorials</a></li><li><a href="https://github.com/search?q=topic%3Aegg-plugin&type=Repositories" alt="Plugins">Plugins</a></li><li><a href="https://github.com/eggjs/egg/releases" alt="Release">Release</a></li></ul>
  </div>
  <dl><dt>Guide</dt><dd><ul><li><a href="/en/intro/index.html">What is Egg?</a></li><li><a href="/en/intro/egg-and-koa.html">Egg and Koa</a></li><li><a href="/en/intro/quickstart.html">Quick Start</a></li></ul></dd><dt>Basis Function</dt><dd><ul><li><a href="/en/basics/structure.html">Directory Structure</a></li><li><a href="/en/basics/objects.html">Built-in Objects</a></li><li><a href="/en/basics/env.html">Environment</a></li><li><a href="/en/basics/config.html">Configuration</a></li><li><a href="/en/basics/middleware.html">Middleware</a></li><li><a href="/en/basics/router.html">Router</a></li><li><a href="/en/basics/controller.html">Controller</a></li><li><a href="/en/basics/service.html">Service</a></li><li><a href="/en/basics/schedule.html">Schedule</a></li><li><a href="/en/basics/extend.html">Extend</a></li><li><a href="/en/basics/app-start.html">Custom Init</a></li></ul></dd><dt>Core</dt><dd><ul><li><a href="/en/core/development.html">Development</a></li><li><a href="/en/core/unittest.html">Unit Testing</a></li><li><a href="/en/core/deployment.html">应用部署</a></li><li><a href="/en/core/logger.html">Logger</a></li><li><a href="/en/core/httpclient.html">HttpClient</a></li><li><a href="/en/core/cookie-and-session.html">Cookie and Session</a></li><li><a href="/en/core/cluster-and-ipc.html">Cluster and IPC</a></li><li><a href="/en/core/view.html">View</a></li><li><a href="/en/core/error-handling.html">Error Handling</a></li><li><a href="/en/core/security.html">Security</a></li><li><a href="/en/core/i18n.html">i18n</a></li></ul></dd><dt>Tutorials</dt><dd><ul><li><a href="/en/tutorials/progressive.html">Progressive</a></li><li><a href="/en/tutorials/mysql.html">MySQL</a></li><li><a href="/en/tutorials/restful.html">RESTful API</a></li><li><a href="/en/tutorials/async-function.html">Async Function</a></li></ul></dd><dt>Advanced</dt><dd><ul><li><a href="/en/advanced/loader.html">Loader</a></li><li><a href="/en/advanced/plugin.html">Plugin</a></li><li><a href="/en/advanced/framework.html">Framework</a></li><li><a href="/en/advanced/cluster-client.html">Cluster Enhancement</a></li><li><a href="/en/advanced/view-plugin.html">View Plugin</a></li></ul></dd><dt>Community</dt><dd><ul><li><a href="/en/plugins/">内置插件列表</a></li><li><a href="/en/contributing.html">Contributing</a></li><li><a href="/en/resource.html">资源</a></li><li><a href="/en/faq.html">FAQ</a></li></ul></dd></dl>
</aside>
<script>
var mobileTrigger = document.getElementById('mobileTrigger');
var mobileAside = document.getElementById('mobileAside');
mobileTrigger.onclick = function(e) {
  if (mobileAside.className.indexOf('mobile-show') === -1) {
    mobileAside.className += ' mobile-show';
  } else {
    mobileAside.className = 'toc';
  }
};
</script>

</div>

  </div>
</body>
<script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<script>
docsearch({
  apiKey: '1561de31a86f79507ea00cdb54ce647c',
  indexName: 'eggjs',
  inputSelector: '#search-query',
});
</script>
<div class="cnzz">
<script src="https://s11.cnzz.com/z_stat.php?id=1261142226&web_id=1261142226" language="JavaScript"></script>
</div>

</html>
