<!DOCTYPE html>
<html lang="en">
<head>
  <title>Extend EGG - Born to build better enterprise frameworks and apps</title>
  <meta charset="utf-8">
  <meta name="description" content="index.description">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="icon" href="/images/favicon.png" type="image/x-icon">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" href="/css/index.css">

</head>
<body>
  <div class="nav" >
  <header>
    <a href="/" class="nav-logo leftpadding" alt="egg"><img src="https://zos.alipayobjects.com/rmsportal/VTcUYAaoKqXyHJbLAPyF.svg"></a>
    <ul class="nav-item">
      <li>
        <form id="search-form">
          <input type="text" id="search-query" class="search-query st-default-search-input">
        </form>
      </li>
      <li><a href="intro/" alt="Guide">Guide</a></li><li><a href="/api/" alt="API">API</a></li><li><a href="tutorials/index.html" alt="Tutorials">Tutorials</a></li><li><a href="https://github.com/search?q=topic%3Aegg-plugin&type=Repositories" alt="Plugins">Plugins</a></li><li><a href="https://github.com/eggjs/egg/releases" alt="Release">Release</a></li>
      <!--
      <li class="translations">
        <a class="nav-link">Translations</a>
        <span class="arrow"></span>
        <ul class="dropdown-content">
          <li><a href="/">中文</a></li>
          <li><a href="/">English</a></li>
        </ul>
      </li>
      -->
      <li><iframe src="https://ghbtns.com/github-btn.html?user=eggjs&repo=egg&type=star&count=true" frameborder="0" scrolling="0" width="150px" height="20px"></iframe></li>
    </ul>
    <a id="mobileTrigger" href="#" class="mobile-trigger">
      <ul>
        <li></li>
        <li></li>
        <li></li>
      </ul>
    </a>
  </header>
</div>

  <div id="container" class="container">
    <div class="page-main">
  <article class="markdown-body">
    <h1>Extend EGG</h1>
    <p>Egg.js is extensible and it provides multiple extension points to enhance the functionality of itself:</p>
<ul>
<li>Application</li>
<li>Context</li>
<li>Request</li>
<li>Response</li>
<li>Helper</li>
</ul>
<p>We could use the extension APIs to help with our developing, or extend the objects given above to enhance the functionality of egg as well while programming.</p>
<h2 id="application"><a class="markdown-anchor" href="#application">#</a> Application</h2>
<p>The object <code>app</code> is just the same aspect as the global application object in Koa. There should be only one <code>app</code> in your application, and it will be created by egg when the application is boot.</p>
<h3 id="access-method"><a class="markdown-anchor" href="#access-method">#</a> Access Method</h3>
<ul>
<li>
<p><code>ctx.app</code></p>
</li>
<li>
<p>You can access the Application object by <code>this.app</code> in Controller, Middleware, Helper, Service. For instance, <code>this.app.config</code> will help you access the Config object.</p>
</li>
<li>
<p>The <code>app</code> object would be injected into the entry function as the first argument in <code>app.js</code>, like this:</p>
 <figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// app.js</span></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</div><div class="line">  <span class="comment">// here you can use the app object</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="how-to-extend"><a class="markdown-anchor" href="#how-to-extend">#</a> How to extend</h3>
<p>Egg will merge the object defined in <code>app/extend/application.js</code> with the prototype of Application object in Koa, then generate object <code>app</code> which is based on the extended prototype when application is boot.</p>
<h4 id="extend-methods"><a class="markdown-anchor" href="#extend-methods">#</a> Extend Methods</h4>
<p>If we want to create a method <code>app.foo()</code>, we can do it like this: ：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// app/extend/application.js</span></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  foo(param) &#123;</div><div class="line">    <span class="comment">// `this` points to the object app, you can access other methods or property of app with this</span></div><div class="line">  &#125;,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="extend-properties"><a class="markdown-anchor" href="#extend-properties">#</a> Extend Properties</h4>
<p>Gernerally speaking, the calculation of properties only need to do once, therefore we have to do some cache, otherwise it will degrade performance of the app as too much calculation would be going to do when access those properties several times.</p>
<p>So, it's recommended to use Symbol + Getter.</p>
<p>For example, if we would like to add a Getter property <code>app.bar</code>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// app/extend/application.js</span></div><div class="line"><span class="keyword">const</span> BAR = <span class="built_in">Symbol</span>(<span class="string">'Application#bar'</span>);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  get bar() &#123;</div><div class="line">    <span class="comment">// `this` points to the app object, you can access other methods or property of app with this</span></div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>[BAR]) &#123;</div><div class="line">      <span class="comment">// It should be more complex in real situation</span></div><div class="line">      <span class="keyword">this</span>[BAR] = <span class="keyword">this</span>.config.xx + <span class="keyword">this</span>.config.yy;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>[BAR];</div><div class="line">  &#125;,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="context"><a class="markdown-anchor" href="#context">#</a> Context</h2>
<p>Context means the context in Koa, which is a  <strong>Request Level</strong> object. That is to say, every request from client will gererate an Context instance. We usually write Context as <code>ctx</code> in short. Through all the doc, both Context and <code>ctx</code> means the context object in Koa.</p>
<h3 id="access-method-2"><a class="markdown-anchor" href="#access-method-2">#</a> Access Method</h3>
<ul>
<li><code>this</code> in middleware is ctx, such as <code>this.cookies.get('foo')</code>。</li>
<li>There are two different ways to write controller. If you use class to describe controller, you can use <code>this.ctx</code> to access Context. Or if you write as method, you can access Context with <code>ctx</code> directly.</li>
<li><code>this</code> in helper, service points to the helper object and service object themselves. Simply use <code>this.ctx</code> to access Context object, such as <code>this.ctx.cookies.get('foo')</code>.</li>
</ul>
<h3 id="how-to-extend-2"><a class="markdown-anchor" href="#how-to-extend-2">#</a> How to extend</h3>
<p>Egg will merge the object defined in <code>app/extend/context.js</code> with the prototype of Context object in Koa. And it will generate a <code>ctx</code> object which is based on the extended prototype when deal with request.</p>
<h4 id="extend-methods-2"><a class="markdown-anchor" href="#extend-methods-2">#</a> Extend Methods</h4>
<p>For instance, we could add a method <code>ctx.foo()</code> in the following way:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// app/extend/context.js</span></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  foo(param) &#123;</div><div class="line">    <span class="comment">// `this` points to the ctx object, you can access other methods or property of ctx </span></div><div class="line">  &#125;,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="extend-properties-2"><a class="markdown-anchor" href="#extend-properties-2">#</a> Extend Properties</h4>
<p>Gernerally speaking, the calculation of properties only need to do once, therefore we have to do some cache, otherwise it will degrade performance of the app as too much calculation would be going to do when access those properties several times.</p>
<p>So, it's recommended to use Symbol + Getter.</p>
<p>For example, if we would like to add a Getter property <code>ctx.bar</code>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// app/extend/context.js</span></div><div class="line"><span class="keyword">const</span> BAR = <span class="built_in">Symbol</span>(<span class="string">'Context#bar'</span>);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  get bar() &#123;</div><div class="line">    <span class="comment">// `this` points to the ctx object, you can access other methods or property of ctx</span></div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>[BAR]) &#123;</div><div class="line">      <span class="comment">// For example, we can get from header, but it should be more complex in real situation.</span></div><div class="line">      <span class="keyword">this</span>[BAR] = <span class="keyword">this</span>.get(<span class="string">'x-bar'</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>[BAR];</div><div class="line">  &#125;,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="request"><a class="markdown-anchor" href="#request">#</a> Request</h2>
<p>Request object is the same as that in Koa, which is a <strong>Request Level</strong> object. It provides a great number of methods to help to access the properties and methods you need.</p>
<h3 id="access-method-3"><a class="markdown-anchor" href="#access-method-3">#</a> Access Method</h3>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">ctx.request</div></pre></td></tr></table></figure>
<p>So many properties and methods in <code>ctx</code> can also be accessed in <code>request</code> object. For those properties and methods, it is just the same to access them eigher <code>ctx</code> or <code>request</code>, such as <code>ctx.url === ctx.request.url</code>.</p>
<p>Here are the properties and methods in <code>ctx</code> which can also be accessed by Request aliases: <a href="http://koajs.com/#request-aliases" target="_blank" rel="external">Koa - Request aliases</a></p>
<h3 id="how-to-extend-3"><a class="markdown-anchor" href="#how-to-extend-3">#</a> How to extend</h3>
<p>Egg will merge the object defined in <code>app/extend/request.js</code> and the prototype of <code>request</code> object build in egg. And it will generate a <code>request</code> object which is based on the extended prototype when deal with request.</p>
<p>For instance, we could add a property <code>request.foo</code> in the following way:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// app/extend/request.js</span></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  get foo() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.get(<span class="string">'x-request-foo'</span>);</div><div class="line">  &#125;,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="response"><a class="markdown-anchor" href="#response">#</a> Response</h2>
<p>Response object is the same as that in Koa, which is a <strong>Request Level</strong> object. It provides a great number of methods to help to access the properties and methods you need.</p>
<h3 id="access-method-4"><a class="markdown-anchor" href="#access-method-4">#</a> Access Method</h3>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">ctx.response</div></pre></td></tr></table></figure>
<p>So many properties and methods in <code>ctx</code> can also be accessed in <code>response</code> object. For those properties and methods, it is just the same to access them eigher <code>ctx</code> or <code>response</code>. For example <code>ctx.status = 404</code> is the same as <code>ctx.response.status = 404</code>.</p>
<p>Here are the properties and methods in <code>ctx</code> which can also be accessed by Response aliases: <a href="http://koajs.com/#response-aliases" target="_blank" rel="external">Koa Response aliases</a></p>
<h3 id="how-to-extend-4"><a class="markdown-anchor" href="#how-to-extend-4">#</a> How to extend</h3>
<p>Egg will merge the object defined in <code>app/extend/response.js</code> and the prototype of <code>response</code> object build in egg. And it will generate a <code>response</code> object which is based on the extended prototype after dealt with request.</p>
<p>For instance, we could add a setter <code>request.foo</code> in the following way:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// app/extend/response.js</span></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  set foo(value) &#123;</div><div class="line">    <span class="keyword">this</span>.set(<span class="string">'x-response-foo'</span>, value);</div><div class="line">  &#125;,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>Then we can use the setter like this: <code>this.response.foo = 'bar';</code></p>
<h2 id="helper"><a class="markdown-anchor" href="#helper">#</a> Helper</h2>
<p>Function Helper can provides some useful utility functions.</p>
<p>We can put some utility functions we use ofter into heper.js as an individual function. Then we can write the complex codes in JavaScript, avoiding to write them everywhere. Besides, such a simple function like Helper allows to write test case much easier.</p>
<p>Egg has had some build-in Helper functions. We can write our own Helper as well.</p>
<h3 id="access-method-5"><a class="markdown-anchor" href="#access-method-5">#</a> Access Method</h3>
<p>Access helper object with <code>ctx.helper</code>, for example:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Assume that home router has already defined in app/router.js</span></div><div class="line">app.get(<span class="string">'home'</span>, <span class="string">'/'</span>, <span class="string">'home.index'</span>);</div><div class="line"></div><div class="line"><span class="comment">// Use helper to calculate the specific url path</span></div><div class="line">ctx.helper.pathFor(<span class="string">'home'</span>, &#123; <span class="attr">by</span>: <span class="string">'recent'</span>, <span class="attr">limit</span>: <span class="number">20</span> &#125;)</div><div class="line"><span class="comment">// =&gt; /?by=recent&amp;limit=20</span></div></pre></td></tr></table></figure>
<h3 id="how-to-extend-5"><a class="markdown-anchor" href="#how-to-extend-5">#</a> How to extend</h3>
<p>Egg will merge the object defined in <code>app/extend/helper.js</code> and the prototype of <code>helper</code> object build in egg. And it will generate a <code>helper</code> object which is based on the extended prototype after dealt with request.</p>
<p>For instance, we could add a method <code>helper.foo()</code> in the following way:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// app/extend/helper.js</span></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  foo(param) &#123;</div><div class="line">    <span class="comment">// // `this` points to the helper object, you can access other methods or property of helper </span></div><div class="line">    <span class="comment">// this.ctx =&gt; context object</span></div><div class="line">    <span class="comment">// this.app =&gt; application object</span></div><div class="line">  &#125;,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="extend-according-to-environment"><a class="markdown-anchor" href="#extend-according-to-environment">#</a> Extend according to environment</h2>
<p>Besides, we can extend the framework in an optional way according to the environment. For example, if you want <code>mockXX()</code> only be able to accessed when doing unittest:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// app/extend/application.unittest.js</span></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  mockXX(k, v) &#123;</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>This file will only be required under unittest environment.</p>
<p>Similarly, we could extend egg in this way for orther object,such as Application, Context, Request, Response and Helper. See more on <a href="./env.html">environment</a></p>

  </article>
  <aside id="mobileAside" class="toc">
  <div class="mobile-menu">
    <ul><li><a href="intro/" alt="Guide">Guide</a></li><li><a href="/api/" alt="API">API</a></li><li><a href="tutorials/index.html" alt="Tutorials">Tutorials</a></li><li><a href="https://github.com/search?q=topic%3Aegg-plugin&type=Repositories" alt="Plugins">Plugins</a></li><li><a href="https://github.com/eggjs/egg/releases" alt="Release">Release</a></li></ul>
  </div>
  <dl><dt>Guide</dt><dd><ul><li><a href="/en/intro/index.html">What is Egg?</a></li><li><a href="/en/intro/egg-and-koa.html">Egg and Koa</a></li><li><a href="/en/intro/quickstart.html">Quick Start</a></li></ul></dd><dt>Basis Function</dt><dd><ul><li><a href="/en/basics/structure.html">Directory Structure</a></li><li><a href="/en/basics/objects.html">Built-in Objects</a></li><li><a href="/en/basics/env.html">Environment</a></li><li><a href="/en/basics/config.html">Configuration</a></li><li><a href="/en/basics/middleware.html">Middleware</a></li><li><a href="/en/basics/router.html">Router</a></li><li><a href="/en/basics/controller.html">Controller</a></li><li><a href="/en/basics/service.html">Service</a></li><li><a href="/en/basics/schedule.html">Schedule</a></li><li><a href="/en/basics/extend.html">Extend</a></li><li><a href="/en/basics/app-start.html">Custom Init</a></li></ul></dd><dt>Core</dt><dd><ul><li><a href="/en/core/development.html">Development</a></li><li><a href="/en/core/unittest.html">Unit Testing</a></li><li><a href="/en/core/deployment.html">应用部署</a></li><li><a href="/en/core/logger.html">Logger</a></li><li><a href="/en/core/httpclient.html">HttpClient</a></li><li><a href="/en/core/cookie-and-session.html">Cookie and Session</a></li><li><a href="/en/core/cluster-and-ipc.html">Cluster and IPC</a></li><li><a href="/en/core/view.html">View</a></li><li><a href="/en/core/error-handling.html">Error Handling</a></li><li><a href="/en/core/security.html">Security</a></li><li><a href="/en/core/i18n.html">i18n</a></li></ul></dd><dt>Tutorials</dt><dd><ul><li><a href="/en/tutorials/progressive.html">Progressive</a></li><li><a href="/en/tutorials/mysql.html">MySQL</a></li><li><a href="/en/tutorials/restful.html">RESTful API</a></li><li><a href="/en/tutorials/async-function.html">Async Function</a></li></ul></dd><dt>Advanced</dt><dd><ul><li><a href="/en/advanced/loader.html">Loader</a></li><li><a href="/en/advanced/plugin.html">Plugin</a></li><li><a href="/en/advanced/framework.html">Framework</a></li><li><a href="/en/advanced/cluster-client.html">Cluster Enhancement</a></li><li><a href="/en/advanced/view-plugin.html">View Plugin</a></li></ul></dd><dt>Community</dt><dd><ul><li><a href="/en/plugins/">内置插件列表</a></li><li><a href="/en/contributing.html">Contributing</a></li><li><a href="/en/resource.html">资源</a></li><li><a href="/en/faq.html">FAQ</a></li></ul></dd></dl>
</aside>
<script>
var mobileTrigger = document.getElementById('mobileTrigger');
var mobileAside = document.getElementById('mobileAside');
mobileTrigger.onclick = function(e) {
  if (mobileAside.className.indexOf('mobile-show') === -1) {
    mobileAside.className += ' mobile-show';
  } else {
    mobileAside.className = 'toc';
  }
};
</script>

</div>

  </div>
</body>
<script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<script>
docsearch({
  apiKey: '1561de31a86f79507ea00cdb54ce647c',
  indexName: 'eggjs',
  inputSelector: '#search-query',
});
</script>
<div class="cnzz">
<script src="https://s11.cnzz.com/z_stat.php?id=1261142226&web_id=1261142226" language="JavaScript"></script>
</div>

</html>
